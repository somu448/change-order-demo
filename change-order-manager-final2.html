<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Change Order Manager</title>
<style>
  body { font-family: sans-serif; margin: 0; }
  .layout { display: flex; }
  .sidebar { width: 200px; padding: 10px; background: #f4f4f4; }
  .main { flex: 1; padding: 20px; }
  .tab-btn { display: block; padding: 10px; cursor: pointer; margin-bottom: 5px; border: none; background: #ddd; }
  .tab-btn.active { background: #bbb; font-weight: bold; }
  .card { border: 1px solid #ccc; border-radius: 6px; margin-bottom: 20px; padding: 10px; background: white; }
  .badge { display: inline-block; padding: 4px 8px; background: #eee; border-radius: 4px; margin-right: 5px; }
  a { cursor: pointer; color: blue; }
</style>
</head>
<body>

<div id="app-root"></div>

<script>
const ROLES = {
  customer: ["My Requests", "New Request"],
  admin: ["All Requests", "Users"],
  supplier: ["Assigned Requests"]
};

const STAGES = ["Submitted", "In Review", "Approved", "Completed"];

let appState = {
  session: { email: "alice@example.com", role: "customer" },
  orders: [
    { id: "1", title: "Order A", stage: "Submitted", priority: "High", createdBy: "alice@example.com", description: "Replace part A", history: [] },
    { id: "2", title: "Order B", stage: "In Review", priority: "Medium", createdBy: "bob@example.com", description: "Update manual", history: [] }
  ],
  activeTab: null
};

function el(tag, props={}, ...children) {
  const element = document.createElement(tag);
  if (props.class) element.className = props.class;
  if (props.style) Object.assign(element.style, props.style);
  if (props.on) for (let e in props.on) element.addEventListener(e, props.on[e]);
  if (props.href) element.setAttribute("href", props.href);
  if (props.value) element.value = props.value;
  children.flat().forEach(c => {
    element.appendChild(typeof c === "string" ? document.createTextNode(c) : c);
  });
  return element;
}

function clear(elm) { while (elm.firstChild) elm.removeChild(elm.firstChild); }

function render() {
  const root = document.getElementById("app-root");
  clear(root);

  const layout = el("div", { class: "layout" });

  // Sidebar tabs
  const sidebar = el("aside", { class: "sidebar" });
  ROLES[appState.session.role].forEach(tab => {
    const btn = el("button", { class: "tab-btn" + (appState.activeTab === tab ? " active" : ""), on: { click: () => { appState.activeTab = tab; render(); } } }, tab);
    sidebar.appendChild(btn);
  });

  // Main content
  const main = el("main", { class: "main" });
  if (!appState.activeTab) appState.activeTab = ROLES[appState.session.role][0];
  main.appendChild(renderTabContent(appState.activeTab));

  layout.appendChild(sidebar);
  layout.appendChild(main);

  root.appendChild(layout);
}

function renderTabContent(tabName) {
  const card = el("div", { class: "card" });
  card.appendChild(el("h2", null, tabName));

  if (tabName.includes("Request")) {
    const list = el("ul");
    appState.orders
      .filter(o => appState.session.role === "admin" || o.createdBy === appState.session.email)
      .forEach(o => {
        const link = el("a", { on: { click: () => renderOrderDetail(o.id) } }, o.title + " (" + o.stage + ")");
        list.appendChild(el("li", null, link));
      });
    card.appendChild(list);
  } else {
    card.appendChild(el("p", null, "Tab content goes here."));
  }
  return card;
}

function renderOrderDetail(id) {
  const root = document.getElementById("app-root");
  clear(root);

  const order = appState.orders.find(o => o.id === id);
  if (!order) {
    root.appendChild(el("p", null, "Order not found."));
    return;
  }

  const container = el("div", { class: "layout" },
    el("aside", { class: "sidebar" },
      el("button", { class: "tab-btn", on: { click: () => render() } }, "← Back to Dashboard")
    ),
    el("main", { class: "main" },
      el("div", { class: "card" },
        el("h2", null, order.title),
        el("div", { class: "badge" }, order.stage),
        el("p", null, "Priority: " + order.priority),
        el("p", null, "Created by: " + order.createdBy),
        el("p", null, order.description || "No description provided."),
        el("label", null, "Change Stage:"),
        (function(){
          const sel = el("select");
          STAGES.forEach(sg => {
            const opt = el("option", { value: sg }, sg);
            if (sg === order.stage) opt.selected = true;
            sel.appendChild(opt);
          });
          sel.addEventListener("change", e => {
            order.history.push({ when: new Date().toISOString(), by: appState.session.email, from: order.stage, to: e.target.value });
            order.stage = e.target.value;
            renderOrderDetail(id);
          });
          return sel;
        })()
      ),
      el("div", { class: "card" },
        el("h3", null, "History"),
        el("ul", null,
          order.history.map(h => el("li", null, `${h.when} — ${h.by} moved from "${h.from}" to "${h.to}"`))
        )
      )
    )
  );

  root.appendChild(container);
}

// Initial render
render();
</script>
</body>
</html>

